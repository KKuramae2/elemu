EL エミュレータ 非公認改造説明
===============
2025-09-23

---------------------------------------
## 目次

* [本ドキュメントについて](#本ドキュメントについて)
* [Doker環境のでの起動](#docker-environment)
* [WebAPI経由ELデバイスのプロパティアクセス](#webapi経由elデバイスのプロパティアクセス)
* [To Do](#to-do)

---------------------------------------
## <a id="about">本ドキュメントについて</a>

神奈川工科大学スマートハウス研究センターの ECHONET Lite 機器エミュレータ (https://github.com/KAIT-HEMS/elemu) の独自拡張説明資料です。

## <a id="docker-environment">Doker環境のでの起動</a>

* Windows 11 Pro 上で docker desktop で、Controller 用 Device 用２つのエミュレータを起動するようにしました。
elemu ディレクトリで以下を実行してください。
```
$ docker compose build
$ docker compose up -d
```
* Controller 用については、初回起動時に、正式ユーザマニュアルの [コントローラ](index.md#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9) を参考にした修正が必要です。
* git clone 後にエミュレータを起動すると、data フォルダにエミュレータのデータファイルが作成されます。
doker compose 時に影響が出る可能性があるので、git clone 後、Docker環境以外でエミュレータを起動しないようにしてください。
* 現状、Dockerでビルドするたびにエミュレータの構成再構築が必要になるのが課題です。（ビルドすると、初期化されてしまい、家庭用エアコン1台が登録された状態になる。

## <a id="webapi-to-drDevices">WebAPI経由ELデバイスのプロパティアクセス</a>

* WebAPIで ECHONET Liteのリモートデバイスに対してプロパティアクセスが可能です。
* まず、コントローラ用エミュレータから、リモートデバイスの機器探索をする必要があります。この探索により、リモートデバイスのEOJとIPアドレスの紐づけがされます。
* APIは以下の通り
```
/api/drDevices/{eoj_id}/properties/{epc_id もしくは MRA で定義されたプロパティ名}
```

## <a id="to-do">To do</a>

* [WebAPI経由ELデバイスのプロパティアクセス](#webapi経由elデバイスのプロパティアクセス)のPUT動作確認
* Dockerビルド時に、毎回家庭用エアコンが登録されないようにする方法
* 上記に関連した話で、コントローラ用エミュレータとデバイス用エミュレータで、起動時の設定を変えたい
* 独立した別メソッドで、コントローラ側で何等かの処理をして、[WebAPI経由ELデバイスのプロパティアクセス](#webapi経由elデバイスのプロパティアクセス)等の処理をしたい。現行エミュレータへの影響を与えずに処理を追加したい。
* 時刻指定によるコントローラ用エミュレータのスケジュール動作実現。現行エミュレータへの影響を与えずに処理を追加したい。
* OpenAPI利用による動作定義。現行エミュレータへの影響を与えずに処理を追加したい。